<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2 Player Obstacle Race</title>
  <style>
    body {
      margin: 0;
      background: #111;
      font-family: sans-serif;
      overflow: hidden;
    }

    canvas {
      display: block;
      background: linear-gradient(to right, #222, #444);
    }

    #winMessage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 2em;
      z-index: 10;
      display: none;
    }
  </style>
</head>
<body>
  <div id="winMessage"></div>
  <canvas id="gameCanvas" width="1200" height="400"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const groundY = 350;
    const gravity = 1;
    const obstacleInterval = 150;
    const finishLine = 1000;

    const players = {
      left: {
        x: 100,
        y: groundY,
        width: 40,
        height: 50,
        color: "cyan",
        keys: { left: "a", right: "d", up: "q", down: "e" },
        velocityY: 0,
        crouching: false,
      },
      right: {
        x: 100,
        y: groundY,
        width: 40,
        height: 50,
        color: "orange",
        keys: { left: "ArrowLeft", right: "ArrowRight", up: "Shift", down: "Control" },
        velocityY: 0,
        crouching: false,
      }
    };

    const obstacles = [];

    function spawnObstacle(side) {
      const x = Math.random() * 600 + 400;
      const y = groundY;
      const height = 40 + Math.random() * 30;
      obstacles.push({
        x: x,
        y: y,
        width: 30,
        height: height,
        side: side,
      });
    }

    let keys = {};

    document.addEventListener("keydown", (e) => {
      keys[e.key] = true;
    });

    document.addEventListener("keyup", (e) => {
      keys[e.key] = false;
    });

    function updatePlayer(player, side) {
      if (keys[player.keys.left]) {
        player.x -= 3;
      }
      if (keys[player.keys.right]) {
        player.x += 3;
      }

      if (keys[player.keys.up] && player.y === groundY) {
        player.velocityY = -15;
      }

      if (keys[player.keys.down]) {
        player.crouching = true;
        player.height = 30;
      } else {
        player.crouching = false;
        player.height = 50;
      }

      player.velocityY += gravity;
      player.y += player.velocityY;

      if (player.y > groundY) {
        player.y = groundY;
        player.velocityY = 0;
      }
    }

    function checkCollision(player, obstacle) {
      return (
        player.x < obstacle.x + obstacle.width &&
        player.x + player.width > obstacle.x &&
        player.y < obstacle.y + obstacle.height &&
        player.y + player.height > obstacle.y
      );
    }

    function drawPlayer(player) {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function drawObstacle(obstacle) {
      ctx.fillStyle = obstacle.side === "left" ? "red" : "yellow";
      ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
    }

    function drawFinishLine() {
      ctx.fillStyle = "white";
      ctx.fillRect(finishLine, 0, 10, canvas.height);
    }

    function displayWinner(winner) {
      const message = document.getElementById("winMessage");
      message.textContent = `${winner} Player Wins!`;
      message.style.display = "block";
      cancelAnimationFrame(gameLoopId);
    }

    let frame = 0;
    let gameLoopId;

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawFinishLine();

      updatePlayer(players.left, "left");
      updatePlayer(players.right, "right");

      drawPlayer(players.left);
      drawPlayer(players.right);

      if (frame % obstacleInterval === 0) {
        spawnObstacle("left");
        spawnObstacle("right");
      }

      // Move and draw obstacles
      for (let i = 0; i < obstacles.length; i++) {
        const obs = obstacles[i];
        obs.x -= 3;
        drawObstacle(obs);

        if (obs.side === "left" && checkCollision(players.left, obs)) {
          players.left.x -= 5;
        }

        if (obs.side === "right" && checkCollision(players.right, obs)) {
          players.right.x -= 5;
        }
      }

      // Win condition
      if (players.left.x >= finishLine) {
        displayWinner("Left");
      } else if (players.right.x >= finishLine) {
        displayWinner("Right");
      } else {
        frame++;
        gameLoopId = requestAnimationFrame(gameLoop);
      }
    }

    gameLoop();
  </script>
</body>
</html>
